name: Build qpdf for macOS (Static)

on:
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout the qpdf source code
      - name: Checkout qpdf source
        uses: actions/checkout@v4
        with:
          repository: qpdf/qpdf
          ref: master  # 你也可以使用具体版本号，如 v11.9.1

      # Step 2: Install dependencies using Homebrew
      - name: Install dependencies
        run: |
          brew install cmake pkg-config zlib libjpeg-turbo

      # Step 3: Build qpdf with static linking (no dynamic libraries)
      - name: Build qpdf (Static)
        run: |
          cmake -S . -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF
          cmake --build build --target qpdf

      # Step 4: Upload the static binary (qpdf)
      - name: Upload static binary
        uses: actions/upload-artifact@v4
        with:
          name: qpdf-macos-static
          path: build/qpdf
