name: Build qpdf for macOS (Static)

on:
  workflow_dispatch:

jobs:
  build-macos:
    runs-on: macos-latest

    steps:
      # Step 1: Checkout your own repository (不再 checkout qpdf 仓库)
      - name: Checkout source code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0  # 获取整个仓库历史记录，避免问题

      # Step 2: Install dependencies using Homebrew
      - name: Install dependencies
        run: |
          brew install cmake pkg-config zlib libjpeg-turbo

      # Step 3: Build qpdf with static linking (no dynamic libraries)
      - name: Build qpdf (Static)
        run: |
          cmake -S . -B build -DCMAKE_BUILD_TYPE=Release -DBUILD_SHARED_LIBS=OFF
          cmake --build build --target qpdf

      # Step 4: Upload the static binary (qpdf)
      - name: Upload static binary
        uses: actions/upload-artifact@v4
        with:
          name: qpdf-macos-static
          path: build/qpdf
